#!Groovy

node {
  stage ('Preparation (Checking out)') {
    git url: 'https://github.com/soigh/mntlab-pipeline.git', branch: 'osamorukova'
  }
  
  stage ('Building code') {
    sh '/opt/gradle/bin/gradle build'
  }
  
  stage ('Testing code') {
    parallel (
    'Unit Test': {sh '/opt/gradle/bin/gradle test'},
    Jacoco: {sh '/opt/gradle/bin/gradle jacocoTestReport'},
    Cucumber: {sh '/opt/gradle/bin/gradle cucumber'}
    )
  }
  
  stage ('Triggering job and fetching artefact after finishing') {
    build job: 'MNTLAB-osamorukova-child4-build-job', parameters: [string(name: 'BRANCH_NAME', value: 'osamorukova')], wait: true
    step {
      copyArtifacts filter: 'osamorukova_dsl_script.tar.gz', projectName: 'MNTLAB-osamorukova-child4-build-job')
    }
  }
  
  stage ('Packaging and Publishing results') {
  }
  
  stage ('Asking for manual approval') {
    input 'Deploy to prod?'
  }
  
  stage ('Deployment') {
    java -jar gradle-simple.jar
  }
  
  stage ('Sending status') {
    sh 'echo SUCCESS'
  }
  
}
